<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Item</title>

    <link
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
        rel="stylesheet">
</head>

<body class="bg-light">
    <div class="container mt-5">

        <h1 id="judul" class="text-primary text-center mb-4">Data Item</h1>

        <div class="d-flex justify-content-end mb-3">
            <a id="baru" href="/tambah" class="btn btn-primary">Tambah Data Baru</a>
        </div>

        <table class="table table-bordered table-striped">
            <thead class="table-primary">
                <tr>
                    <th>No.</th>
                    <th>Nama Item</th>
                    <th>Stok Item</th>
                    <th>Harga Item</th>
                    <th colspan="2" class="text-center">Aksi</th>
                </tr>
            </thead>

            <tbody id="data">
                <% let nomor = 1; %>
                <% if (typeof barang !== 'undefined' && barang.length > 0) { %>
                    <% barang.forEach(items => { %>
                    <tr>
                        <td><%= nomor++ %></td>
                        <td><%= items.name %></td>
                        <td><%= items.qty_stock %></td>
                        <td>Rp <%= new Intl.NumberFormat('id-ID').format(items.price) %></td>

                        <td class="text-center">
                            <a href="/edit/<%= items.id %>" class="btn btn-warning btn-sm">Edit</a>
                        </td>

                        <td class="text-center">
                            <button onclick="deleteItem('<%= items.id %>')" 
                                class="btn btn-danger btn-sm">Hapus</button>
                        </td>
                    </tr>
                    <% }) %>
                <% } else { %>
                    <tr>
                        <td colspan="6" class="text-center">Data item belum tersedia.</td>
                    </tr>
                <% } %>
            </tbody>

        </table>

    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        async function deleteItem(id) {
            if (confirm("Apakah Anda yakin ingin menghapus item ini?")) {

                let result = await fetch(`/api/items/${id}`, {
                    method: "DELETE"
                });

                if (result.ok) {
                    alert("Item berhasil dihapus");
                    location.reload();
                } else {
                    try {
                        const errorData = await result.json();
                        alert(`Gagal menghapus item: ${errorData.message || 'Kesalahan Server'}`);
                    } catch (e) {
                        alert("Gagal menghapus item: Kesalahan Jaringan atau Server");
                    }
                }
            }
        }
    </script>

</body>
</html>